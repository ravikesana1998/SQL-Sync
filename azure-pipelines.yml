trigger:
- main

pool:
  name: 'self-hosted-pool'

variables:
  ResourceGroupName: 'rg-23-6'
  ServerName: 'studentserver9'
  HubDatabase: 'studentDB1'
  SyncGroupName: 'StudentSyncGroup'
  MemberDatabase: 'studentDB2'

steps:
# ðŸ”¹ Setup SQL Data Sync (create sync group + member)
- task: AzurePowerShell@5
  displayName: 'Setup SQL Data Sync'
  inputs:
    azureSubscription: 'DevopsServiceConnection'
    ScriptPath: 'setup-and-trigger-sync.ps1'
    ScriptArguments: >
      -ResourceGroupName $(ResourceGroupName)
      -ServerName $(ServerName)
      -HubDatabase $(HubDatabase)
      -MemberDatabase $(MemberDatabase)
      -SyncGroupName $(SyncGroupName)
    azurePowerShellVersion: 'LatestVersion'
    pwsh: true

# (Optional) Trigger Sync
- task: AzurePowerShell@5
  displayName: 'Trigger Sync'
  inputs:
    azureSubscription: 'DevopsServiceConnection'
    ScriptPath: 'trigger-sync.ps1'
    ScriptArguments: >
      -ResourceGroupName $(ResourceGroupName)
      -ServerName $(ServerName)
      -DatabaseName $(HubDatabase)
      -SyncGroupName $(SyncGroupName)
    azurePowerShellVersion: 'LatestVersion'
    pwsh: true
